# Verification Methods

Phase 4で各指摘を検証し、確信度ラベルを付与するための手法。

## 確信度ラベル基準

| Label | 定義 | 必要条件 |
|-------|------|---------|
| **Verified** | ツール/コード検査で確認済み | grep/AST/ツール出力で該当コードのパターン一致を確認 |
| **Likely** | コンテキストから高確度 | コード構造・フロー分析から判断、ただし実行検証は未実施 |
| **Possible** | 追加調査推奨 | 状況証拠のみ、環境依存や動的挙動に関わる指摘 |

## 指摘タイプ別検証パターン

### Security

| 指摘 | 検証方法 | Verified条件 |
|------|---------|-------------|
| SQLインジェクション | grep でパラメータ直接結合を確認 | 文字列結合/テンプレートリテラルにユーザー入力が直接含まれることを確認 |
| XSS | innerHTML/dangerouslySetInnerHTML の使用箇所を確認 | サニタイズなしの動的HTML生成を確認 |
| 秘密情報露出 | grep で API key/password/secret のハードコードを検索 | リテラル文字列として秘密値が存在 |
| 認可漏れ | ルーティング/ミドルウェア定義で認可チェックの有無を確認 | 保護すべきエンドポイントに認可ミドルウェアが未設定 |

### Data Integrity

| 指摘 | 検証方法 | Verified条件 |
|------|---------|-------------|
| レースコンディション | 共有状態への非同期アクセスパターンを確認 | ロック/mutex/atomic なしの共有変数書き込みを確認 |
| トランザクション欠如 | DB操作の前後でトランザクション制御を確認 | 複数DB操作がトランザクション外で実行されることを確認 |
| バリデーション不備 | 入力パスの型チェック/バリデーション呼び出しを確認 | エントリポイントにバリデーションなしでデータが通過 |

### Reliability

| 指摘 | 検証方法 | Verified条件 |
|------|---------|-------------|
| リソースリーク | open/acquire の後に close/release/defer を確認 | 対応するリソース解放が全パスで行われていない |
| 未処理例外 | try-catch の範囲とcatch内の処理を確認 | 例外発生可能な呼び出しが catch/error handler の外にある |
| エラー握り潰し | catch ブロック内の処理を確認 | 空の catch ブロックまたは `_ =` パターン |

### Type Safety

| 指摘 | 検証方法 | Verified条件 |
|------|---------|-------------|
| any の使用 | grep で `any` 型の使用箇所を確認 | 型安全な代替が可能な箇所で any が使用されている |
| null安全性 | Optional チェーンやnullチェックの有無を確認 | null/undefined になり得る値の未チェック参照 |

### Performance

| 指摘 | 検証方法 | Verified条件 |
|------|---------|-------------|
| N+1クエリ | ループ内のDB/APIクエリ呼び出しを確認 | ループ内でクエリが発行されるコードパスを確認 |
| 不要な計算 | ループ内の不変計算やメモ化の欠如を確認 | ホットパスで再計算されている値が外に出せることを確認 |

## 検証手順

1. **コード存在確認**: 指摘箇所のファイル:行が実在するか Read/grep で確認
2. **パターンマッチ**: 指摘内容に対応するコードパターンを grep で検索
3. **コンテキスト確認**: 周辺コードを読み、誤検知でないか判断
4. **ラベル付与**: 検証結果に基づき Verified/Likely/Possible を付与

## 偽陽性パターン一覧

以下のパターンはLLMが誤って指摘しやすい。検証時に特に注意する。

| パターン | 説明 | 対処 |
|---------|------|------|
| **フレームワーク管理のリソース** | ORMやDIコンテナが自動管理するリソースを「リーク」と指摘 | フレームワークのライフサイクル管理を確認 |
| **意図的なany/unsafe** | FFI境界や型消去が必要な箇所での any 使用 | コメントや型アサーション文の存在を確認 |
| **テスト内のショートカット** | テストコードでの簡略化を本番コードと同基準で指摘 | ファイルパスが test/spec パターンか確認 |
| **設定ファイルの秘密** | `.env.example` や `.env.test` の値を秘密情報と指摘 | ファイル名とgitignoreを確認 |
| **意図的な再レンダリング** | 状態変化に伴う必要な再レンダリングを不要と指摘 | 状態依存関係を確認 |
| **既存パターンの踏襲** | プロジェクト全体で使われている慣習を逸脱として指摘 | プロジェクト内の同一パターンの使用頻度を確認 |
| **コンパイラ最適化対象** | コンパイラが最適化する箇所をパフォーマンス問題と指摘 | 言語/コンパイラの最適化保証を確認 |
