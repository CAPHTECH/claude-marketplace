# カバレッジ基準詳細

## 目次

1. [基準の考え方](#基準の考え方)
2. [基本カバレッジ基準](#基本カバレッジ基準)
3. [品質特性別カバレッジ](#品質特性別カバレッジ)
4. [プロジェクト別カスタマイズ](#プロジェクト別カスタマイズ)

---

## 基準の考え方

### "全組み合わせ"ではなく"代表集合"を定義する

現実には状態×入力×環境の全組み合わせは不可能。代表集合を定義することで：

- 抜けは「代表集合に入っているのにテストがない」として検出可能になる
- 「なぜその基準が必要か」を失敗モード→影響の形で説明できる

### 基準策定の原則

1. **要求から導出**: 要求がないのにテストがあるのは無駄
2. **リスクベース**: 高リスク領域ほど厳密なカバレッジ
3. **実現可能性**: 現実的なコストで達成できる基準

---

## 基本カバレッジ基準

### 1. 要求カバレッジ

| レベル | 定義 | 適用場面 |
|--------|------|---------|
| **Level 1** | 全REQに対して少なくとも1つのTCND | 最低限 |
| **Level 2** | 全REQに対して正常系・異常系各1つ | 標準 |
| **Level 3** | 全REQに対して正常・異常・境界各1つ | 高信頼性 |

**失敗モード**: 要求未対応 → 仕様と実装の乖離 → ユーザー期待との不一致

### 2. 状態遷移カバレッジ

| レベル | 定義 | 適用場面 |
|--------|------|---------|
| **All States** | 全状態を少なくとも1回通過 | 最低限 |
| **All Transitions** | 全遷移を少なくとも1回実行 | 標準 |
| **Transition Pairs** | 遷移の組み合わせ（N-switch） | 高信頼性 |

**失敗モード**: 未テスト遷移での状態不整合 → データ破損、処理停止

### 3. 入力空間カバレッジ

| 技法 | 定義 | 適用場面 |
|------|------|---------|
| **同値分割** | 同じ振る舞いをする入力群から1つずつ | 必須 |
| **境界値分析** | 境界とその±1 | 必須 |
| **ペアワイズ** | 全パラメータの2因子組み合わせ | 組み合わせ多い場合 |
| **全組み合わせ** | 全パラメータの全組み合わせ | 安全クリティカル |

**失敗モード**: 境界での誤処理 → off-by-one、オーバーフロー、不正状態

### 4. エラー網羅

| カテゴリ | テストすべきパターン |
|---------|-------------------|
| **ネットワーク** | timeout, connection refused, reset |
| **HTTP** | 4xx（400, 401, 403, 404）, 5xx（500, 502, 503） |
| **データ** | 不正payload, 欠落フィールド, 型不一致 |
| **順序** | 順序逆転, 重複, 遅延到着 |
| **競合** | 同時更新, レースコンディション |

**失敗モード**: エラー未処理 → クラッシュ、データ不整合、セキュリティホール

---

## 品質特性別カバレッジ

### 性能（Performance）

| 観点 | テスト条件 |
|------|----------|
| **レスポンス時間** | 目標値での成功（95%タイル） |
| **スループット** | 想定同時ユーザー数での処理能力 |
| **負荷時挙動** | ピーク時のグレースフルデグラデーション |
| **リソース使用** | メモリリーク、CPU使用率上限 |

### セキュリティ（Security）

| 観点 | テスト条件 |
|------|----------|
| **認証** | 正常ログイン、不正ログイン、ブルートフォース |
| **認可** | 権限チェック、権限昇格試行 |
| **入力検証** | インジェクション（SQL, XSS, Command） |
| **セッション** | セッション固定、タイムアウト、同時ログイン |
| **データ保護** | 暗号化、ログマスク、エラー情報漏洩 |

### 可用性（Availability）

| 観点 | テスト条件 |
|------|----------|
| **障害復旧** | サービス再起動後の状態 |
| **フェイルオーバー** | 冗長構成での切り替え |
| **データ永続性** | クラッシュ後のデータ整合性 |
| **バックアップ/リストア** | 復旧手順の動作確認 |

### アクセシビリティ（Accessibility）

| 観点 | テスト条件 |
|------|----------|
| **スクリーンリーダー** | ARIA属性、読み上げ順序 |
| **キーボード操作** | Tab順序、フォーカス可視性 |
| **色覚対応** | コントラスト比、色のみに依存しない |
| **拡大表示** | 200%拡大での使用可否 |

### 互換性（Compatibility）

| 観点 | テスト条件 |
|------|----------|
| **ブラウザ** | Chrome, Safari, Firefox, Edge |
| **OS** | Windows, macOS, iOS, Android |
| **デバイス** | デスクトップ, タブレット, モバイル |
| **バージョン** | サポート対象の最小/最大バージョン |

---

## プロジェクト別カスタマイズ

### テンプレート

```markdown
# カバレッジ基準: [プロジェクト名]

## 基本基準

| カテゴリ | レベル | 根拠 |
|---------|-------|------|
| 要求カバレッジ | Level 2 | 標準的な品質水準 |
| 状態遷移カバレッジ | All Transitions | 注文状態管理が複雑 |
| 入力空間カバレッジ | 同値分割+境界値 | フォーム入力が多い |
| エラー網羅 | 全カテゴリ | 外部API依存が多い |

## 品質特性別基準

| 特性 | 適用 | 観点 | 根拠 |
|------|------|------|------|
| 性能 | ○ | レスポンス2秒、100同時 | SLA要件 |
| セキュリティ | ○ | 認証/認可/入力検証 | 個人情報取扱 |
| 可用性 | ○ | 障害復旧 | 24/365運用 |
| アクセシビリティ | △ | 基本的な対応のみ | 法的要件なし |
| 互換性 | ○ | Chrome/Safari最新2バージョン | ユーザー分析結果 |

## 除外事項

以下はスコープ外とする：
- パフォーマンス限界テスト（別途負荷テストで実施）
- ペネトレーションテスト（外部委託）
- 古いブラウザ対応（IE, 旧Edge）
```

### カスタマイズの観点

1. **リスクベース**: 高リスク領域は厳格に、低リスクは緩やかに
2. **コスト考慮**: 全組み合わせは高コスト、代表値で妥協点を探る
3. **規制要件**: 業界標準・法規制で必須となるカバレッジ
4. **過去障害**: 過去に問題があった領域は重点的に

---

## カバレッジ達成の検証

### チェックリスト

```markdown
## カバレッジ検証チェックリスト

- [ ] 全REQに対してTCNDが存在する
- [ ] 状態遷移図の全遷移にTCNDが存在する
- [ ] 入力項目の境界値がテスト条件に含まれる
- [ ] 外部IFの失敗パターンがテスト条件に含まれる
- [ ] セキュリティ観点のテスト条件が存在する
- [ ] 環境カバレッジが定義されている
```

### 定量的な確認

```
要求カバレッジ率 = (TCNDが存在するREQ数 / 全REQ数) × 100%
状態カバレッジ率 = (テストされる遷移数 / 全遷移数) × 100%
```

目標値の例:
- 要求カバレッジ: 100%（必須）
- 状態遷移カバレッジ: 100%（主要フロー）、80%（全体）
- 入力空間カバレッジ: 境界値100%、ペアワイズ80%
