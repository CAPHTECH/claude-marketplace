# PRオンボーディング横断ガードレール

PRオンボーディング全体で禁止する振る舞いを定義する。

---

## 1. 根拠なしの断言

**禁止事項**:
- もっともらしい説明ほど危険
- コード・テスト・ドキュメントの参照なしに影響範囲を断言
- 「おそらく」「たぶん」を省略して確定的に述べる

**正しい振る舞い**:
```
❌ 「この変更は他の機能に影響しません」
✅ 「依存関係を確認した結果、呼び出し元は src/api/user.ts のみ。
    他のモジュールからの参照はありません（grep結果: 0件）」

❌ 「パフォーマンスに問題ありません」
✅ 「負荷テストは未実施のため、パフォーマンス影響は未確定。
    Unknownsに追加し、リリース前に検証予定」
```

**チェック方法**:
- 発言のたびに「根拠は何か」を自問
- 根拠がない場合は「推測」「未確認」と明示

---

## 2. 未実施の検証の捏造（最重要）

**禁止事項**:
- 実行していないテストを「実行した」と書く
- 確認していない動作を「確認した」と書く
- CIが通っていないのに「全パス」と書く

**正しい振る舞い**:
```
❌ Evidence:
   - [x] 負荷テスト: 1000 req/s でも問題なし

✅ Evidence:
   - [x] 単体テスト: npm test 全パス（CI#12345）
   - [ ] 負荷テスト: 未実施（Unknownsに記載）

❌ 「手動で動作確認済み」（実際は未確認）

✅ 「手動での動作確認は未実施。自動テストのみ。
    リリース前にステージング環境で確認予定」
```

**これが最重要な理由**:
- 検証の捏造は信用を一撃で破壊する
- 一度でも捏造が発覚すると、PRオンボーディング全体が形骸化する
- 「やっていない」と正直に書く方が、長期的に価値がある

---

## 3. 長文化で安心させる

**禁止事項**:
- 読み手の注意を散らし、重要点が埋もれる
- 「詳しく書いたから大丈夫」という錯覚を生む
- PRの1画面目に本質が入らない

**正しい振る舞い**:
```
❌ ## Summary
   このPRは、ユーザーセッション管理機能において、
   これまで30分に設定されていたセッションタイムアウト値を
   60分に変更するものです。この変更の背景として、
   カスタマーサポートへの問い合わせが...（500文字続く）

✅ ## Summary
   セッションタイムアウトを30分→60分に変更。
   カスタマーサポートへの再ログイン問い合わせ削減が目的。
```

**基準**:
| 項目 | 上限 |
|------|------|
| Summary | 3行 |
| 各セクション | 5〜10行 |
| PR本文全体 | 1〜2画面 |
| 詳細 | リンク先に逃がす |

---

## 4. 影響範囲の過小評価

**禁止事項**:
- 特にデータ、権限、外部I/F、並行性で過小評価しがち
- 「たぶん影響ない」で済ませる
- 依存関係の調査を省略

**危険な領域（要注意）**:
| 領域 | リスク | 確認方法 |
|------|--------|---------|
| データ | スキーマ変更、データ破損 | マイグレーション有無、既存データへの影響 |
| 権限 | 権限昇格、アクセス制御漏れ | 認可ロジックの変更有無 |
| 外部I/F | API互換性、契約違反 | 公開APIの変更有無 |
| 並行性 | レースコンディション、デッドロック | 共有状態の変更有無 |

**正しい振る舞い**:
```
❌ Blast Radius: なし

✅ Blast Radius:
   - 呼び出し元: src/api/user.ts, src/api/admin.ts
   - データ: sessions テーブルの expires_at カラム値が変わる
   - 外部I/F: 影響なし（内部処理のみ）
   - 並行性: セッション更新の競合可能性あり（後述）
```

---

## 5. "問題ないはず"の楽観

**禁止事項**:
- 不確実なことを確実かのように扱う
- 検証をスキップして「大丈夫」と言う
- リスクを意図的に軽視

**危険なフレーズ（検出シグナル）**:
- 「問題ないはず」
- 「たぶん大丈夫」
- 「影響は軽微」（根拠なし）
- 「今まで問題なかった」
- 「誰も使っていない機能」

**正しい振る舞い**:
```
❌ 「この変更は問題ないはずです」

✅ 「この変更の影響について：
    - 確認済み: 単体テスト全パス
    - 未確認: 負荷テスト、モバイルアプリ連携
    未確認事項はUnknownsに記載し、リリース前に検証します」

❌ 「影響は軽微です」

✅ 「影響範囲を調査した結果：
    - 直接影響: セッション管理モジュール（3ファイル）
    - 間接影響: 調査中（Unknownsに記載）」
```

---

## ガードレール違反の検出

PRオンボーディング中に以下が発生したら、ガードレール違反の兆候:

| 兆候 | 違反の可能性 | 対処 |
|------|-------------|------|
| 「影響なし」が多すぎる | #4 過小評価 | 根拠を追記、または未確認に変更 |
| Evidenceが全部チェック済み | #2 捏造リスク | 実際に実行したか再確認 |
| PR本文が3画面以上 | #3 長文化 | 重点を絞り、詳細はリンクへ |
| Unknownsが空 | #5 楽観 | 本当に不確実性がないか再検討 |
| 「〜のはず」が多い | #1, #5 | 根拠を追加、または未確認に変更 |

---

## ガードレールの目的

これらのガードレールは、以下を防ぐためにある:

1. **誤った安心**: 詳しく書いてあるから大丈夫、という錯覚
2. **レビューの形骸化**: 重要点が埋もれ、本質的なレビューができない
3. **信頼の喪失**: 一度の捏造で、PRオンボーディング全体が形骸化
4. **障害時の混乱**: 影響範囲が分からず、対応が遅れる
5. **技術的負債**: 「なぜこうなっているか」が分からなくなる

PRオンボーディングは「説明」ではなく「契約」。
契約に嘘や曖昧さがあると、後で必ず問題になる。
