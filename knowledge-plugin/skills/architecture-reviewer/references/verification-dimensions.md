# 検証次元（Verification Dimensions）

DCC（Design Consistency Checker）由来の検証次元のうち、architecture-reviewer の既存分析と重複しない3次元を定義する。

- D1（Traceability）, D4（Invariant Enforce）, D6（Concurrency）, D7（Cross-Doc）, D8（Capability） は既存のコンポーネント/インタラクション/クロスカッティング分析で網羅済みのため省略。
- D2, D3, D5 を追加次元として統合する。

---

## D2: テスト網羅性（Design-to-Test Coverage）

設計文書で定義されたすべての不変条件・状態遷移・エッジケースに対応するテストが存在するかを検証する。

### チェック項目

| 項目 | 確認内容 |
|------|----------|
| 不変条件テスト | 各 LAW-* に対応するテストがあるか |
| 状態遷移テスト | 各遷移に正常系 + 異常系テストがあるか |
| エラー条件テスト | 設計で定義された各エラー条件にテストがあるか |
| 境界条件テスト | 設計で言及された境界条件にテストがあるか |

### 検出パターン

```
For each invariant/rule in component-dossier:
  1. テストファイルから関連テスト名やアサーションを検索
  2. テストが不変条件を実際に検証しているか確認（名前だけでなく内容）
  Report: COVERED / PARTIAL / UNTESTED
```

### 典型的な失敗

- 「X は決して起こらない」と設計に記載があるが、それを検証するテストがない
- テストが存在するがハッピーパスのみで、不変条件違反をテストしていない
- 状態マシンに N 遷移あるが N-2 しかテストされていない

---

## D3: スキーマ実装一致（Schema-to-Implementation Match）

データスキーマ（JSON Schema, SQL DDL, WIT インターフェース等）と実装コードが一致しているかを検証する。

### チェック項目

| 項目 | 確認内容 |
|------|----------|
| フィールド存在 | スキーマの全フィールドがコードで読み書きされているか |
| 必須/任意一致 | required/optional がコードの処理と一致しているか |
| 列挙値一致 | スキーマの enum 値がコードの定数と一致しているか |
| 型一致 | スキーマの型がコードの型と一致しているか |

### 検出パターン

```
For each schema file:
  1. フィールド名、型、制約をパース
  2. シリアライズ/デシリアライズするコードを特定
  3. フィールドごとに比較
  Report: MATCH / FIELD_MISSING_IN_CODE / FIELD_MISSING_IN_SCHEMA / TYPE_MISMATCH
```

### 典型的な失敗

- スキーマに `additionalProperties: false` だがコードが余分なフィールドを送信
- スキーマの enum に 3 値あるがコードが 2 値しか処理しない
- マイグレーションでカラム追加したが対応するコード側の struct にフィールドがない

---

## D5: 障害モード網羅性（Error & Failure Mode Coverage）

設計で定義されたすべての障害モードに対して、処理コードとリカバリ戦略が実装されているかを検証する。

### チェック項目

| 項目 | 確認内容 |
|------|----------|
| エラー型の存在 | 設計の各エラー型にコードパスがあるか |
| 特定ハンドリング | catch-all ではなく具体的なハンドリングか |
| リカバリ実装 | 設計で記述されたリカバリ/フォールバックが実装されているか |
| エラーメッセージ | エラーメッセージがアクショナブルか |

### 検出パターン

```
For each failure mode in component-dossier:
  1. そのシナリオのエラー処理コードを特定
  2. 処理が設計のリカバリ記述と一致するか検証
  3. エラーが伝播されているか握りつぶされているか確認
  Report: HANDLED / GENERIC_CATCH / SWALLOWED / MISSING
```

### 典型的な失敗

- コンポーネントカードに failure_mode が記載されているが対応するエラーハンドリングがない
- エラー処理が存在するが `catch(e) { log(e) }` で握りつぶしている
- 設計では「3回リトライ後に pending 状態」と記載だがコードではリトライなし
