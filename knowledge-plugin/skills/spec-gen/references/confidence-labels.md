# 確度ラベル（Confidence Labels）

## 目的

コードからspecを生成する際、「断定」と「推測」を混同しない。
確度ラベルにより、読み手が「ここは信用できる／ここは要確認」を即座に判断できる。

## ラベル定義

### Verified（検証済み）

**定義**: テストまたは実行結果で確認済み

**根拠の例**:
- ユニットテストで検証
- 統合テストで検証
- 実際の実行ログで確認
- Property-based testで検証

**表記**:
```yaml
response:
  status: 200
  confidence: Verified
  evidence: tests/api/users.test.ts:45-52
```

**使用基準**:
- 対応するテストケースが存在する
- テストが最近パスしている（CI確認）
- テストが当該振る舞いを直接検証している

### Observed（観測済み）

**定義**: コード上で確認できる（ただしテスト未確認）

**根拠の例**:
- ソースコードの実装
- 型定義
- 設定ファイル
- スキーマ定義

**表記**:
```yaml
precondition:
  condition: "ユーザーが認証済み"
  confidence: Observed
  evidence: src/middleware/auth.ts:23
```

**使用基準**:
- コード上で該当ロジックが確認できる
- ただし、テストで検証されていない
- 分岐条件やガード句として存在

### Assumed（仮定）

**定義**: 一般的にそうだろうが、コード上の根拠が薄い

**根拠の例**:
- 一般的な慣習
- 類似システムからの類推
- ドキュメントの記述（コードと未照合）
- 命名規則からの推測

**表記**:
```yaml
purpose:
  statement: "ユーザー認証を提供する"
  confidence: Assumed
  evidence: null
  note: "エンドポイント名から推測"
```

**使用基準**:
- コード上に明示的な根拠がない
- 一般的な解釈として妥当
- 人間による確認が推奨される

### Unknown（不明）

**定義**: 判断不能。推測すら困難。

**根拠の例**:
- 該当コードが見つからない
- 複数解釈が可能
- 外部依存で確認不能

**表記**:
```yaml
sla:
  availability: Unknown
  evidence: null
  note: "運用ドキュメントが見つからない"
```

**使用基準**:
- 推測すると「整った嘘」になる
- 正直に「不明」とする方が価値がある
- 追加調査が必要

## ラベル選択フローチャート

```
該当する振る舞いのテストがある？
  ├─ YES → テストが当該を直接検証？
  │         ├─ YES → Verified
  │         └─ NO  → Observed
  │
  └─ NO → コード上で確認できる？
           ├─ YES → Observed
           │
           └─ NO → 一般的推測が妥当？
                    ├─ YES → Assumed
                    └─ NO  → Unknown
```

## ラベル別の扱い方

| ラベル | spec化 | ドキュメント化 | 意思決定根拠 |
|--------|--------|--------------|------------|
| Verified | そのまま | そのまま | 信頼可 |
| Observed | そのまま | 「要テスト」付記 | 慎重に |
| Assumed | 「草案」として | 「未確認」付記 | 確認後のみ |
| Unknown | 「不明」として | 「調査必要」付記 | 不可 |

## 層別の期待分布

### 層A（インターフェース）

```
Verified: 40-60%（型・スキーマがテスト対象）
Observed: 30-40%
Assumed:  5-10%
Unknown:  0-5%
```

### 層B（振る舞い）

```
Verified: 20-40%（主要パスのみテスト）
Observed: 40-60%
Assumed:  10-20%
Unknown:  5-10%
```

### 層C（業務意味）

```
Verified: 0-10%（ADR等で決裁済みのみ）
Observed: 10-20%
Assumed:  40-60%
Unknown:  20-40%
```

## 危険信号

### 層Cで Verified が多い

「整った嘘」の可能性。コードには「なぜ」が書かれていないのに断定している。

### 層Aで Unknown が多い

基本的なインターフェースすら読み取れていない。調査不足。

### 層Bで Assumed が多い

振る舞いの確認が不十分。テストまたはコードレビューが必要。

## エビデンス形式

```yaml
evidence:
  file: src/api/users.ts
  line: 45-52
  symbol: getUserById
  commit: abc123  # オプション: 確認時点のコミット
```

ファイルパス + 行範囲 + シンボル名を組み合わせて一意に特定。
