# 品質評価基準詳細

## 概要

このドキュメントでは、Claim の品質を評価するための詳細な基準を定義する。

## 評価軸

### 1. 正確性（Accuracy）

Claim が事実と一致しているかどうか。

| レベル | 説明 | 対応 |
|--------|------|------|
| 完全に正確 | 現在の事実と100%一致 | positive feedback |
| ほぼ正確 | 軽微な誤りあり（例: バージョン） | negative + 修正 |
| 部分的に正確 | 一部正しいが重要な誤りあり | 置換を検討 |
| 不正確 | 事実と異なる | delete |

**確認方法:**
```
1. コードベースで直接確認
2. CLAUDE.md / ドキュメントと照合
3. 実際の動作を検証
4. チームメンバーに確認
```

**例: 正確性の評価**

```yaml
# 評価対象
text: "認証には AWS Cognito を使用"

# 確認ステップ
1. src/auth/ のコードを確認
2. .env の認証関連変数を確認
3. package.json の依存関係を確認

# 結果
→ 正確: aws-amplify が使用されている
→ positive feedback
```

### 2. 関連性（Relevance）

Claim がプロジェクトにとって有用かどうか。

| レベル | 説明 | 対応 |
|--------|------|------|
| 高関連性 | 日常的に参照される | positive feedback |
| 中関連性 | 特定の状況で有用 | 維持 |
| 低関連性 | めったに必要ない | 削除検討 |
| 無関係 | プロジェクトに関係ない | delete |

**評価指標:**
- 過去30日で参照された回数
- 関連するタスクの頻度
- 他の Claim との関連数

**例: 関連性の評価**

```yaml
# 高関連性
text: "pnpm のみ使用（npm 禁止）"
理由: 毎日の開発で参照される

# 低関連性
text: "2023年1月の障害対応で〇〇を実施"
理由: 過去の一時的なイベント、再発の可能性低い
```

### 3. 鮮度（Freshness）

Claim が最新の状態を反映しているかどうか。

| レベル | 基準 | 対応 |
|--------|------|------|
| 新鮮 | 30日以内に確認/更新 | 維持 |
| やや古い | 30-90日 | レビュー推奨 |
| 古い | 90-180日 | 要確認 |
| 非常に古い | 180日以上 | 要検証または削除 |

**鮮度が重要な Claim タイプ:**
- 技術スタック（バージョン依存）
- 外部サービス連携
- 認証・セキュリティ設定

**鮮度があまり重要でない Claim タイプ:**
- 設計原則
- コーディング規約
- アーキテクチャ決定（ADR）

### 4. 明確性（Clarity）

Claim が明確で理解しやすいかどうか。

| レベル | 説明 | 対応 |
|--------|------|------|
| 明確 | 曖昧さがない | 維持 |
| やや曖昧 | 解釈の余地あり | 改善推奨 |
| 曖昧 | 複数の解釈が可能 | 要修正 |
| 不明確 | 意味が不明 | 再構造化または削除 |

**明確性のチェックポイント:**
- 具体的なファイルパス/識別子があるか
- 数値や条件が明示されているか
- アクション可能な形式か

**例: 明確性の改善**

```yaml
# 曖昧
text: "いくつかのコンポーネントで状態管理を使用"

# 明確
text: "Editor, Sidebar, PageList コンポーネントで XState による状態管理を使用"
```

### 5. 一貫性（Consistency）

Claim が他の Claim と矛盾していないかどうか。

| 状態 | 説明 | 対応 |
|------|------|------|
| 一貫 | 矛盾なし | 維持 |
| 軽微な不整合 | 表現の違いのみ | 統一を検討 |
| 矛盾 | 内容が対立 | 即時解決が必要 |

**矛盾検出の方法:**
```
1. 同じトピックの Claim を検索
2. 内容を比較
3. 矛盾がある場合は CONTRADICTS 関係を確認
4. 正しい情報を特定して解決
```

## 品質スコアリング

### 総合品質スコア

各評価軸に重みを付けてスコアを算出:

| 評価軸 | 重み | スコア範囲 |
|--------|------|-----------|
| 正確性 | 40% | 0-100 |
| 関連性 | 25% | 0-100 |
| 鮮度 | 15% | 0-100 |
| 明確性 | 15% | 0-100 |
| 一貫性 | 5% | 0-100 |

**総合スコア = Σ(軸スコア × 重み)**

### スコア別アクション

| スコア | 品質レベル | 推奨アクション |
|--------|-----------|---------------|
| 90-100 | 優良 | positive feedback |
| 70-89 | 良好 | 維持 |
| 50-69 | 要改善 | negative feedback + 改善計画 |
| 30-49 | 問題あり | 修正または置換 |
| 0-29 | 不良 | delete |

## 問題タイプ別の品質基準

### fact（事実）の品質基準

```yaml
必須:
  - 検証可能であること
  - 具体的なエビデンスがあること
  - 現在の状態を反映していること

推奨:
  - ファイルパスや識別子を含む
  - 確認日時を provenance に記録
```

### preference（好み）の品質基準

```yaml
必須:
  - 誰の好みかが明確
  - 適用範囲が明確

推奨:
  - 理由が記録されている
  - 代替案との比較がある
```

### task（タスク）の品質基準

```yaml
必須:
  - アクション可能な形式
  - 完了条件が明確

推奨:
  - 優先度が示されている
  - 関連する Issue/PR への参照
```

### policy_hint（ポリシー）の品質基準

```yaml
必須:
  - ルールとして適用可能な形式
  - 適用範囲が明確

推奨:
  - 理由/根拠がある
  - 例外条件が明示されている
```

## 品質レビューチェックリスト

### 単一 Claim のレビュー

- [ ] **正確性**: 内容は事実と一致するか？
- [ ] **関連性**: このプロジェクトで必要か？
- [ ] **鮮度**: 情報は最新か？
- [ ] **明確性**: 曖昧さはないか？
- [ ] **一貫性**: 他の Claim と矛盾しないか？
- [ ] **分類**: kind/scope/boundary_class は適切か？
- [ ] **出所**: provenance は記録されているか？

### バッチレビュー（複数 Claim）

- [ ] 重複 Claim はないか？
- [ ] 矛盾する Claim はないか？
- [ ] カバレッジは十分か（重要な領域に Claim があるか）？
- [ ] 不要な Claim（古い、低関連性）はないか？

## 品質メトリクス

### メモリ全体の健全性指標

| メトリクス | 計算方法 | 目標値 |
|-----------|----------|--------|
| 平均品質スコア | Σスコア / Claim数 | ≥70 |
| 正確性率 | 正確な Claim数 / 総数 | ≥95% |
| 重複率 | 重複 Claim数 / 総数 | ≤5% |
| 矛盾件数 | CONTRADICTS 関係の数 | 0 |
| 鮮度率（90日以内） | 新鮮な Claim数 / 総数 | ≥70% |

### トレンド監視

- 週次で品質スコアの推移を確認
- 問題 Claim の増加傾向を検出
- 特定のトピックで品質低下がないか確認

## 自動品質チェック

### 検出可能な問題

- **重複検出**: content_hash の衝突、類似テキストの検出
- **矛盾検出**: 同じ Entity に関する相反する Claim
- **鮮度アラート**: 更新から一定期間経過した Claim
- **孤立 Claim**: Entity/Relation との関連がない Claim

### 人間の判断が必要な問題

- 正確性の検証（事実確認が必要）
- 関連性の評価（ビジネス判断が必要）
- 矛盾の解決（どちらが正しいかの判断）
- 統合の決定（どう統合するかの設計）
