# =================================================================
# Active Context スキーマ
# =================================================================
# eld-sense-activation の出力。タスクに最適化されたコンテキスト。
# =================================================================

$schema: "https://json-schema.org/draft/2020-12/schema"
type: object
required:
  - goal
  - constraints
  - expected_output

properties:
  goal:
    type: string
    description: タスクの真の目的（3行以内）
    maxLength: 500

  constraints:
    type: array
    description: 制約条件（最大5項目）
    maxItems: 5
    items:
      type: object
      properties:
        type:
          type: string
          enum: [security, performance, compatibility, deadline, other]
        description:
          type: string

  references:
    type: array
    description: 参照すべき情報（最大3ファイル）
    maxItems: 3
    items:
      type: object
      required:
        - path
      properties:
        path:
          type: string
        reason:
          type: string
        trust_level:
          type: string
          enum: [high, medium, low]

  context:
    type: object
    properties:
      environment:
        type: string
        description: 実行環境
      dependencies:
        type: array
        items:
          type: string
      preconditions:
        type: array
        items:
          type: string

  expected_output:
    type: object
    required:
      - format
    properties:
      format:
        type: string
        description: 成果物の形式
      quality:
        type: string
        description: 品質基準
      validation:
        type: string
        description: 検証方法

  issue_contract:
    type: object
    description: Issue Contract下書き（eld-sense-requirements-brainstormingで作成）
    properties:
      goal:
        type: string
      invariants:
        type: array
        items:
          type: string
      acceptance_criteria:
        type: array
        items:
          type: object
          properties:
            criterion:
              type: string
            evidence_level:
              type: string
              enum: [L0, L1, L2, L3, L4]
      stop_conditions:
        type: array
        items:
          type: string
      law_candidates:
        type: array
        items:
          type: object
          properties:
            id:
              type: string
            description:
              type: string
            severity:
              type: string
              enum: [S0, S1, S2, S3]
      term_candidates:
        type: array
        items:
          type: object
          properties:
            id:
              type: string
            description:
              type: string
            type:
              type: string
              enum: [Entity, Value, Context, Boundary]
      open_questions:
        type: array
        items:
          type: string

  metadata:
    type: object
    properties:
      created_at:
        type: string
        format: date-time
      briefing_ref:
        type: string
        description: briefing.yamlへの参照
