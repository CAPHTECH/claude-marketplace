# CLAUDE.md ベストプラクティス分析基準

各観点の詳細な検出パターンと判定基準。

## 目次

1. [量の適正性](#1-量の適正性)
2. [内容の適正性](#2-内容の適正性)
3. [NG内容の検出](#3-ng内容の検出)
4. [情報配置の適正性](#4-情報配置の適正性)
5. [階層の適正性](#5-階層の適正性)
6. [強調の適正性](#6-強調の適正性)
7. [構造の適正性](#7-構造の適正性)

---

## 1. 量の適正性

大原則: LLMは命令数が増えると遵守の質が均一に低下する。

| チェック項目 | 🔴 要対応 | 🟡 推奨 | 🟢 良好 |
|---|---|---|---|
| 推定命令数 | 150件超 | 100-150件 | 100件未満 |
| ファイル行数 | 300行超 | 150-300行 | 150行未満 |
| @参照の展開後サイズ | 大量のトークン消費 | 中程度 | 最小限 |

**削除テスト**: 各行に「この行を削除したらClaudeがミスをするか？」を適用。Noなら削除候補。

## 2. 内容の適正性

書くべき内容は「コードや設定ファイルから読み取れない情報」かつ「毎セッション必要なもの」のみ。

### 書くべき内容（WHAT / WHY / HOW）

| カテゴリ | 具体例 | 検出方法 |
|---|---|---|
| WHAT: コードベースの地図 | 技術スタック、ディレクトリ構成、モノレポ内の責務 | セクション有無を確認 |
| WHY: 目的と背景 | サービスの目的、設計判断の理由 | 背景説明の有無 |
| HOW: 作業手順と制約 | Bashコマンド、コードスタイル、テスト方法、ブランチ規則 | 手順セクション有無 |

### コードから読み取れる情報（削除候補）

以下はコードや設定ファイルから推測可能なため、CLAUDE.mdに書く必要がない:

- `package.json`/`Cargo.toml`等から分かる依存関係の列挙
- 型定義ファイルから分かるインターフェース仕様
- `.eslintrc`/`.prettierrc`から分かるフォーマットルール
- `tsconfig.json`から分かるTypeScript設定
- ファイル構成から自明なディレクトリ説明

## 3. NG内容の検出

| NGパターン | 検出方法 | 重大度 | 改善方法 |
|---|---|---|---|
| `@docs/`等で全ファイル埋め込み | `@`構文でディレクトリ参照 | 🔴 | テキストでパスを記述（「docs/foo.md を参照」） |
| 代替手段なしの禁止事項 | 「〜するな」「〜禁止」のみで代替未記載 | 🟡 | 「〜の代わりに△△を使え」に書き換え |
| 包括的なマニュアル・仕様書 | 長大な説明、全機能のドキュメント | 🔴 | Claudeが間違えた箇所だけを記録 |
| 特定ドメイン限定の知識 | 決済、RLS等の専門知識 | 🟡 | `.claude/skills/`にSkillとして分離 |
| 毎回必ず実行させたい処理 | 「必ず〜を実行」系の命令 | 🟡 | Hooksに移譲（`.claude/settings.json`） |
| 重複する記述 | 同じ指示が複数箇所に存在 | 🟡 | 1箇所に統合 |
| 古くなった記述 | 現在のコードと矛盾する指示 | 🔴 | 削除または更新 |

## 4. 情報配置の適正性

| 情報の性質 | 適切な置き場所 | 検出: CLAUDE.mdに混入していたら |
|---|---|---|
| 毎回必要・普遍的 | `CLAUDE.md` | ✅ 正しい配置 |
| 特定ドメイン限定の知識 | `.claude/skills/` | 🟡 Skillに分離を推奨 |
| 必ず実行すべき処理 | Hooks（`.claude/settings.json`） | 🟡 Hookに移譲を推奨 |
| 進行中タスクの状態・計画 | `plan.md`/`context.md` | 🟡 別ファイルに移動 |
| 繰り返しワークフロー | `.claude/commands/` | 🟡 コマンドに分離を推奨 |
| チームの意思決定履歴 | `docs/` + テキスト参照 | 🟡 docsに移動し参照リンクのみ残す |

## 5. 階層の適正性

### ファイル配置の基準

| ファイル | 用途 | git管理 |
|---|---|---|
| `~/.claude/CLAUDE.md` | 全プロジェクト共通のグローバル設定 | 個人 |
| `./CLAUDE.md` | プロジェクトルート（チーム共有） | ✅ |
| `./CLAUDE.local.md` | 個人設定 | ❌（.gitignoreに追加） |
| `./src/feature/CLAUDE.md` | サブディレクトリ（動的ロード） | ✅ |

### 検出パターン

| 問題 | 検出方法 | 改善 |
|---|---|---|
| グローバルにプロジェクト固有情報 | `~/.claude/CLAUDE.md`に特定プロジェクトの記述 | プロジェクトの`./CLAUDE.md`に移動 |
| プロジェクトに個人設定 | `./CLAUDE.md`に個人の好み（エディタ設定等） | `./CLAUDE.local.md`に移動 |
| サブディレクトリ未活用 | 特定機能の詳細がルートに集中 | 該当サブディレクトリの`CLAUDE.md`に分離 |
| `@`構文の乱用 | 大量の`@ファイル`参照 | テキストパス参照に置換 |

## 6. 強調の適正性

### 強調の使い方

| 手法 | 用途 | 注意 |
|---|---|---|
| `IMPORTANT:` | 守ってほしいルール | 多用すると効果が薄れる（5件以下推奨） |
| `YOU MUST` | 絶対に守るべきルール | 最重要事項のみ（2-3件推奨） |
| 冒頭配置 | 最重要事項 | LLMは先頭に注意が向く |
| 末尾配置 | 次に重要な事項 | LLMは末尾にも注意が向く |

### 検出パターン

| 問題 | 検出方法 | 改善 |
|---|---|---|
| 強調の過多 | IMPORTANT/MUST等が10件超 | 本当に重要な5件以下に絞る |
| 重要事項が埋没 | 最重要ルールがファイル中盤にある | 冒頭または末尾に移動 |
| 強調なし | 重要ルールに強調がない | 適切なルールにIMPORTANT:を追加 |

## 7. 構造の適正性

### 推奨セクション構造

```
# [プロジェクト名]
## Overview        ← サービスの目的（1-2文）
## Tech Stack      ← 技術スタックと主要ライブラリ
## Commands        ← よく使うBashコマンド
## Code Style      ← コードスタイル規約
## Architecture    ← ディレクトリ構成と設計判断
## Workflow        ← ブランチ戦略、PR方針
## Known Gotchas   ← 落とし穴と代替手段
```

### 検出パターン

| 問題 | 検出方法 | 改善 |
|---|---|---|
| Overviewがない | プロジェクト目的の記述なし | 1-2文で追加 |
| Commandsがない | ビルド/テストコマンドの記述なし | 主要コマンドを追加 |
| セクション構造が不明瞭 | 見出しなしで平文が続く | 推奨構造に沿ってセクション分け |
| 巨大なセクション | 1セクションが50行超 | サブセクションに分割またはSkillに分離 |
