# 運用観測性チェックリスト

## 1. 設定管理

### 起動時検証
- [ ] 必須設定が欠けていたら即終了する
- [ ] 設定値のバリデーション（型、範囲、形式）がある
- [ ] デフォルト値が明示されている
- [ ] 環境変数と設定ファイルの優先順位が明確

### 設定の可視化
- [ ] 起動時に設定をログ出力する（秘密は除く）
- [ ] 設定変更履歴が追跡可能

## 2. ヘルスチェック

### Liveness（生存確認）
- [ ] プロセスが生きているか確認できる
- [ ] 無限ループ/デッドロック状態を検出できる
- [ ] エンドポイント: `/health/live`

### Readiness（準備完了）
- [ ] リクエストを受け付けられる状態か確認できる
- [ ] 依存サービスの接続状態を確認する
- [ ] エンドポイント: `/health/ready`

### Startup（起動完了）
- [ ] 初期化処理が完了したか確認できる
- [ ] 長時間の初期化でも正しく待機できる

## 3. ログ

### 構造化
- [ ] JSON形式で出力している
- [ ] タイムスタンプがISO8601形式
- [ ] ログレベルが適切に設定されている

### 相関
- [ ] 相関ID（correlation_id）が含まれている
- [ ] リクエストIDが含まれている
- [ ] 分散トレースIDが含まれている（必要に応じて）

### コンテキスト
- [ ] 操作名（operation）が含まれている
- [ ] 結果（success/failure）が含まれている
- [ ] 処理時間（duration_ms）が含まれている

### エラー
- [ ] エラー分類（error_type）が含まれている
- [ ] スタックトレースが含まれている（開発時）
- [ ] 機密情報が含まれていない

## 4. メトリクス

### 基本（RED / USE）
- [ ] Rate: リクエスト数（request_total）
- [ ] Error: エラー率（error_total）
- [ ] Duration: レイテンシ（request_latency_seconds）
- [ ] Utilization: リソース使用率
- [ ] Saturation: 飽和度（キュー深度等）
- [ ] Errors: エラー数

### ビジネス
- [ ] 重要な業務指標が計測されている
- [ ] SLI（Service Level Indicator）が定義されている

### アラート
- [ ] 異常検知の閾値が設定されている
- [ ] アラートの通知先が設定されている

## 5. エラーハンドリング

### 分類
- [ ] validation_error: 入力検証失敗
- [ ] policy_violation: ビジネスルール違反
- [ ] invariant_broken: 内部整合性違反
- [ ] external_error: 外部システム障害
- [ ] internal_error: 内部エラー

### 対処
- [ ] リトライ可能なエラーが識別できる
- [ ] サーキットブレーカーが設定されている
- [ ] フォールバックが用意されている

## 6. デバッグ支援

### 再現性
- [ ] エラー発生時の入力が復元可能
- [ ] 状態のスナップショットが取得可能
- [ ] リクエストの再送が可能

### 可視化
- [ ] 内部状態を確認するエンドポイントがある（本番は認証必須）
- [ ] 依存関係の状態が確認できる

## 7. グレースフルシャットダウン

- [ ] SIGTERMで正常終了する
- [ ] 進行中のリクエストを完了させる
- [ ] 接続を適切にクローズする
- [ ] タイムアウトが設定されている

## 評価基準

| レベル | 達成項目 |
|--------|---------|
| 最低限 | 設定検証、ヘルス、構造化ログ |
| 推奨 | 上記 + メトリクス、エラー分類 |
| 成熟 | 上記 + 分散トレース、SLI/SLO |
