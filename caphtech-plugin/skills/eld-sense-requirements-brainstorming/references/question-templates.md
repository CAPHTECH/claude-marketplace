# 質問テンプレート集

要件明確化のための体系的な質問カテゴリとテンプレート。

## 質問設計の原則

1. **具体的で答えやすい**: 抽象的な質問を避け、選択肢や例を示す
2. **Law/Term観点を明示**: なぜこの質問をするのか、Law/Termとの関係を説明
3. **段階的**: 1度に多くを聞かず、3-5個の質問に絞る
4. **オープンエンド**: yes/noだけでなく、理由や背景も引き出す

## カテゴリ1: Law/Term観点

### テンプレート: 守るべき条件の定義

```markdown
### [機能名]で守らなければならない条件は何ですか？
- なぜこれを聞くか: LAW-[law-id] の定義に必要
- 例:
  - データ整合性: トランザクション内で完結する
  - 認可: 特定のロールのみアクセス可能
  - 監査: すべての操作をログに記録
```

### テンプレート: 語彙の境界定義

```markdown
### [用語]の定義と範囲を教えてください
- なぜこれを聞くか: TERM-[term-id] の境界を明確化
- 例:
  - "アクティブユーザー": 過去30日以内にログインしたユーザー
  - "有効な注文": 支払い完了かつキャンセルされていない注文
  - "期限切れ": 作成から24時間経過
```

### テンプレート: 状態遷移の条件

```markdown
### [状態A]から[状態B]に遷移する条件は？
- なぜこれを聞くか: LAW-[law-id] の Precondition/Postcondition を定義
- 例:
  - "下書き" → "公開": 管理者承認 + 必須項目入力完了
  - "処理中" → "完了": すべてのバリデーション通過
  - "一時停止" → "アクティブ": ユーザーの明示的な再開操作
```

## カテゴリ2: 境界条件

### テンプレート: 入力の範囲

```markdown
### [入力パラメータ]の有効な範囲は？
- なぜこれを聞くか: バリデーションルールとエラーメッセージを定義
- 最小値/最大値:
  - 文字数: 最小1文字、最大255文字
  - 数値: 0以上、1,000,000以下
  - 日付: 過去日付のみ/未来日付のみ/制限なし
- 許可する文字種:
  - 英数字のみ/日本語可/特殊文字可
```

### テンプレート: 例外ケース

```markdown
### 以下のケースはどう扱いますか？
- なぜこれを聞くか: エッジケース処理とエラーハンドリングを設計
- ケース1: [例外的な状況]
  - 例: 既に同じIDが存在する
  - 期待される挙動: エラー/上書き/スキップ？
- ケース2: [境界値]
  - 例: 空文字列/null/0
  - 期待される挙動: 拒否/デフォルト値/そのまま受け入れ？
```

### テンプレート: 制約条件

```markdown
### [機能]に適用される制約は？
- なぜこれを聞くか: システム制約と技術制約を明確化
- リソース制約:
  - 同時実行数: 最大何件？
  - データ量: 最大何MB/何件？
- 時間制約:
  - タイムアウト: 何秒？
  - リトライ: 何回まで？
```

## カテゴリ3: 失敗モード

### テンプレート: エラーハンドリング

```markdown
### [操作]が失敗した時の挙動は？
- なぜこれを聞くか: エラー処理とロールバック戦略を設計
- 失敗パターン:
  1. ネットワークエラー: リトライ/即時失敗/キュー保存？
  2. データ不整合: ロールバック/部分成功/エラー記録？
  3. 外部API失敗: フォールバック/エラー通知/ユーザーへ表示？
- ユーザーへの通知:
  - エラーメッセージの内容は？
  - リカバリー手順の案内は？
```

### テンプレート: 違反時の動作

```markdown
### [Law]が破られた場合、どうしますか？
- なぜこれを聞くか: 防御的設計とフェイルセーフを確立
- 検出方法:
  - どの時点で検出？（事前/事後/リアルタイム）
- 対処方法:
  - 例: 拒否/警告のみ/自動修正/管理者通知
- 記録方法:
  - ログ/アラート/メトリクス？
```

### テンプレート: 部分失敗

```markdown
### バッチ処理で一部が失敗した場合は？
- なぜこれを聞くか: トランザクション境界とリトライ戦略を決定
- オプション:
  1. 全体ロールバック（All or Nothing）
  2. 成功分のみコミット（Best Effort）
  3. 失敗分を別キューに保存して後でリトライ
```

## カテゴリ4: 性能要件

### テンプレート: レスポンスタイム

```markdown
### [操作]のレスポンスタイム要件は？
- なぜこれを聞くか: 性能目標と測定方法を定義
- 目標値:
  - 平均: XXX ms以内
  - 95パーセンタイル: XXX ms以内
  - 最大許容: XXX ms
- 測定方法:
  - どこからどこまで？（API境界/UI操作全体）
```

### テンプレート: スループット

```markdown
### [機能]の想定負荷は？
- なぜこれを聞くか: スケーラビリティ要件を設計
- 通常時:
  - リクエスト数: XXX/秒、XXX/分
- ピーク時:
  - リクエスト数: XXX/秒、XXX/分
  - 同時接続数: XXX
- データ増加:
  - 1年後のデータ量予測: XXX GB、XXX 万件
```

### テンプレート: リソース制約

```markdown
### [機能]のリソース使用上限は？
- なぜこれを聞くか: リソース制約と監視を設計
- メモリ: 最大 XXX MB
- CPU: 最大 XX%
- ストレージ: 最大 XXX GB
- ネットワーク帯域: 最大 XXX Mbps
```

## カテゴリ5: セキュリティ要件

### テンプレート: 認証・認可

```markdown
### [機能]にアクセスできるのは誰ですか？
- なぜこれを聞くか: 認可ポリシーとアクセス制御を定義
- 認証要件:
  - 必須/不要
  - 方式: パスワード/OAuth/API Key/証明書
- 認可要件:
  - ロール: 管理者/一般ユーザー/ゲスト
  - 条件: 自分のデータのみ/組織内のみ/全体
```

### テンプレート: データ保護

```markdown
### [データ]の機密性要件は？
- なぜこれを聞くか: 暗号化と保護レベルを決定
- 保存時:
  - 暗号化: 必要/不要
  - 方式: AES-256/他
- 転送時:
  - TLS必須/不要
- ログ記録:
  - 平文OK/マスキング必須/記録禁止
```

### テンプレート: 監査要件

```markdown
### [操作]の監査ログは必要ですか？
- なぜこれを聞くか: 監査ログ設計とコンプライアンス対応
- 記録内容:
  - 誰が/いつ/何を/どうした
  - IPアドレス/ユーザーエージェント
- 保存期間:
  - XXX日/XXXヶ月/XXX年
- アクセス権:
  - 誰が閲覧可能？
```

## カテゴリ6: 既存システムとの関係

### テンプレート: 後方互換性

```markdown
### 既存の[機能/API]との互換性は？
- なぜこれを聞くか: 移行戦略と破壊的変更の影響を評価
- 既存実装:
  - どのように動作している？
  - 依存しているクライアントは？
- 移行方針:
  - 並行稼働期間: XXXヶ月
  - 非推奨通知: いつから？
  - 完全削除: いつ？
```

### テンプレート: 依存関係

```markdown
### [機能]が依存する外部システムは？
- なぜこれを聞くか: 外部依存の可用性とエラーハンドリングを設計
- 依存先:
  - システム名: XXX
  - 通信方式: HTTP/gRPC/メッセージキュー
  - SLA: 可用性XX%、レスポンスタイムXXms
- フォールバック:
  - 依存先が落ちた場合の挙動は？
  - キャッシュ/デフォルト値/エラー？
```

### テンプレート: データ移行

```markdown
### 既存データの移行は必要ですか？
- なぜこれを聞くか: データ移行戦略とダウンタイムを計画
- 移行対象:
  - データ量: XXX件、XXX GB
  - 形式変換: 必要/不要
- 移行方式:
  - 一括/段階的
  - ダウンタイム: 許容可能時間
- ロールバック:
  - 失敗時のロールバック方法は？
```

## 質問の優先順位付け

すべてのカテゴリを網羅する必要はない。以下の基準で優先順位を付ける:

### High Priority（必ず質問）
- Law/Term観点: 核心的な制約と語彙
- 失敗モード: クリティカルなエラーケース
- 既存システムとの関係: 破壊的変更の有無

### Medium Priority（リスクに応じて）
- 境界条件: 入力範囲と例外ケース
- セキュリティ要件: 機密データ扱う場合

### Low Priority（必要に応じて）
- 性能要件: 明確な性能問題がない限り後回し

## 質問の組み合わせパターン

### パターンA: 新規機能開発
1. Law/Term観点（守るべき条件と語彙）
2. 失敗モード（エラーハンドリング）
3. 境界条件（入力範囲と例外）

### パターンB: 既存機能の変更
1. 既存システムとの関係（後方互換性）
2. Law/Term観点（変更による影響）
3. 失敗モード（新たなエラーケース）

### パターンC: セキュリティ関連
1. セキュリティ要件（認証・認可・データ保護）
2. 監査要件（ログ記録）
3. 失敗モード（セキュリティ違反時の挙動）

### パターンD: パフォーマンス重視
1. 性能要件（レスポンスタイム・スループット）
2. 境界条件（負荷上限）
3. 失敗モード（過負荷時の挙動）
