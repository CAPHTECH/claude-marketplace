---
name: codex-negotiation
context: fork
description: Claude と Codex (gpt-5.3-codex) で構造化された議論を行い、設計判断や技術選定の合意を形成するスキル。「codexと議論」「codexとネゴシエーション」「codexと設計議論」「設計を議論して」「技術選定を議論」「両方の視点で比較」「codexと比較検討」と言った時にトリガーする。
---

# Codex Negotiation

Claude と Codex (gpt-5.3-codex) が構造化された議論プロトコルに従い、設計判断・技術選定・アーキテクチャ方針の合意を形成する。

## 議論プロトコル

### フェーズ概要

```
提案 → 批判 → 防御/修正 → 収束
 ↑                         |
 └─── 未収束なら再提案 ────┘
```

**目安: 3ラウンドで収束。** 収束しなければユーザーに判定を委ねる。

### Phase 1: 提案（Proposal）

Claudeが初期提案を作成し、Codexに批判を求める。

```bash
codex exec -m gpt-5.3-codex -c 'model_reasoning_effort="xhigh"' \
  "以下の提案に対して批判的レビューを行ってください。

## 議題
<議題>

## 提案
<Claudeの提案内容>

## 評価軸
以下の軸で0-10のスコアと根拠を付けてください:
- 実装コスト: 開発工数・複雑性
- 保守性: 変更容易性・理解しやすさ
- パフォーマンス: 速度・リソース効率
- スケーラビリティ: 成長への対応力
- リスク: 失敗可能性・未知の問題

## 指示
- 提案の弱点・見落としを具体的に指摘
- 可能なら対案を提示
- 対案がある場合は同じ評価軸でスコアリング"
```

### Phase 2: 批判への防御/修正（Defense/Revision）

Codexの批判を受けて、Claudeが防御または提案を修正する。

- **防御**: 批判への反論を根拠付きで提示
- **修正**: 有効な批判を取り込んで提案を改善
- **対案採用**: Codexの対案が優れていれば採用を検討

修正後、再度Codexに評価を依頼:

```bash
codex exec resume --last \
  "批判を受けて提案を修正しました。再評価してください。

## 修正提案
<修正内容>

## 修正理由
- <批判Aへの対応: 修正/防御/対案採用>

## 残る懸念
同じ評価軸で再スコアリングし、まだ残る問題があれば指摘してください。"
```

### Phase 3: 収束（Convergence）

以下のいずれかで収束と判断:

1. **合意**: 両者のスコア差が全軸で2以内
2. **対立点の明確化**: 合意できない点が具体化され、トレードオフが明確
3. **3ラウンド到達**: 収束しない場合はユーザー判定に移行

### 判断材料の提示

収束後（またはラウンド上限到達後）、以下を構造化して提示:

```markdown
## 議論結果

### 合意点
- <両者が合意した事項>

### 対立点
- <対立点>: Claude=<立場> / Codex=<立場>

### 評価軸比較

| 評価軸 | 提案A | 提案B | 差分 |
|--------|-------|-------|------|
| 実装コスト | 7 | 5 | +2 |
| 保守性 | 8 | 6 | +2 |
| パフォーマンス | 5 | 8 | -3 |
| スケーラビリティ | 6 | 7 | -1 |
| リスク | 7 | 4 | +3 |

### 推奨
<Claudeの推奨とその根拠>

### ユーザーへの判断ポイント
- <ユーザーが決めるべき事項>
```

## バリエーション

### 3案以上の比較

議題に対して複数の選択肢がある場合:

```bash
codex exec -m gpt-5.3-codex -c 'model_reasoning_effort="xhigh"' \
  "以下の選択肢を比較評価してください。

## 議題
<議題>

## 選択肢
### A: <案A>
<詳細>

### B: <案B>
<詳細>

### C: <案C>
<詳細>

## 評価軸
各案を以下の軸で0-10でスコアリングし、推奨順位を付けてください:
- 実装コスト / 保守性 / パフォーマンス / スケーラビリティ / リスク

最も推奨する案とその理由も述べてください。"
```

### 既存案のブラッシュアップ

既に方針が決まっていて、改善点を探る場合:

```bash
codex exec -m gpt-5.3-codex -c 'model_reasoning_effort="xhigh"' \
  "以下の設計案を改善してください。方向性は維持したまま、弱点を補強する修正を提案してください。

## 現在の設計
<設計内容>

## 制約（変更不可）
- <変えられない部分>

## 改善したい点
- <具体的な懸念>"
```

### ユーザー参加型

ユーザーの意見を途中で取り込む場合:

1. Phase 1-2 を実行してClaudeとCodexの見解を整理
2. 中間結果をユーザーに提示し、AskUserQuestion で方向性を確認
3. ユーザーの方向性を踏まえて残りのフェーズを実行

## 固定パラメータ

- **model**: `-m gpt-5.3-codex` (常に指定)
- **reasoning**: `-c 'model_reasoning_effort="xhigh"'` (常に指定)
- **セッション継続**: `codex exec resume --last` でラウンド間の文脈を維持

## 注意事項

- 議論の各ラウンドの要約をユーザーに報告する
- スコアは絶対値より差分に注目する（案同士の相対比較が重要）
- 収束しない場合は対立点を明確にしてユーザー判断に委ねる
- Claudeは中立的な立場を保ち、Codexの優れた指摘は積極的に取り込む
