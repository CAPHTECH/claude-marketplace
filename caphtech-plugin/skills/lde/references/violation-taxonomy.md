# Violation Taxonomy（違反分類）

## 概要

違反の扱いが曖昧だと、結局「例外if」が散って統一が壊れる。
Law Cardで必ず違反の種類と対応を定義する。

## 違反分類

| 種類 | 意味 | 典型例 | 推奨対応 |
|------|------|--------|----------|
| **Bug** | 実装がLawに反している | 計算ミス | 即修正、回帰テスト追加 |
| **User Error** | 入力がPreを満たさない | 上限超過 | 400/UI誘導、監視は別系統 |
| **Business Exception** | Policyで例外許容 | 審査で承認 | 監査ログ、承認フロー |
| **Data Drift** | 外部/データが前提破壊 | 他系遅延 | 隔離・補正・リコンシル |
| **Compliance** | 法令・監査要件 | 保管期限違反 | 監査対応、再発防止 |

## Severity（重要度）

| レベル | 説明 | 対応時間 |
|--------|------|----------|
| **S0** | ビジネス停止レベル | 即時対応 |
| **S1** | 重大な機能障害 | 24時間以内 |
| **S2** | 部分的な機能劣化 | 1週間以内 |
| **S3** | 軽微・改善レベル | バックログ |

## Handling（違反時動作）

| 動作 | 説明 | 用途 |
|------|------|------|
| **reject** | 処理を拒否 | Pre違反時の標準動作 |
| **compensate** | 補償処理を実行 | トランザクション失敗時 |
| **warn** | 警告のみ、処理は続行 | 軽微な違反、移行期間 |
| **quarantine** | データを隔離 | 不整合データの一時対応 |
| **audit** | 監査ログに記録 | コンプライアンス対応 |

## 違反対応フロー

```
違反検出
    │
    ├─ Bug → 即修正 + 回帰テスト
    │
    ├─ User Error → 400/UI誘導
    │
    ├─ Business Exception → 承認フロー/監査ログ
    │
    ├─ Data Drift → 隔離 + 調査 + 補正
    │
    └─ Compliance → 監査対応 + 再発防止
```

## Law Cardでの記述例

```md
- Violation Handling:
  - Severity: S1
  - When Violated: reject | quarantine
  - Owner: inventory-team
```
