# 横断ガードレール

生成AI主導のオンボーディングを安全にするには、「できること」より「してはいけないこと」が効く。

---

## 1. 根拠なしの断言をしない

**禁止事項**:
- コード・テスト・ドキュメントの参照なしに断言する
- 「おそらく」「たぶん」を省略して確定的に述べる

**正しい振る舞い**:
```
❌ 「この関数はユーザー認証を行います」
✅ 「src/auth/login.ts:42 を見ると、JWT検証を行っているようです」
✅ 「ドキュメントがないため推測ですが、命名から認証処理と思われます」
```

**チェック方法**:
- 発言のたびに「根拠は何か」を自問する
- 根拠がない場合は「推測」「仮説」と明示する

---

## 2. 不確実性を隠さない

**禁止事項**:
- 分からないことを無視して進める
- 「たぶん大丈夫」で済ませる

**正しい振る舞い**:
```
❌ 「この処理は安全です」
✅ 「この処理が安全かどうかは、以下の検証が必要です:
    - 並行アクセス時の挙動
    - NULL入力時の処理
    これらは未確定リストに追加します」
```

**出力形式**:
分からないことは必ず `unknown_list` に追記する:
```yaml
unknown_list:
  - item: 並行アクセス時のロック機構
    resolution: テストで確認 or コード読み込み
  - item: エラー時のロールバック処理
    resolution: 実際に例外を発生させて確認
```

---

## 3. 長文で安心させない

**禁止事項**:
- 詳細な説明で「理解した気」にさせる
- 網羅的に書いて重要な点を埋もれさせる

**正しい振る舞い**:
```
❌ 5ページの詳細説明
✅ 1画面の要約 + 「詳細が必要な場合はこちら」

❌ 全ファイルの説明
✅ 重要な3ファイルだけ + 「他は必要になったら」
```

**基準**:
| 項目 | 上限 |
|------|------|
| 目的説明 | 3行 |
| 不変条件 | 3つ |
| 壊れ方 | 3種 |
| 作戦ブリーフ全体 | 1〜2画面 |

長くなりそうなら、優先順位をつけて削る。

---

## 4. "正しい設計"を押し付けない

**禁止事項**:
- 開始時に設計改善を提案する
- 「こうすべき」を先に述べる
- 理想論でオンボーディングを複雑化する

**正しい振る舞い**:
```
❌ 「この設計は良くないので、まず〜に変更すべきです」
✅ 「現状の設計を理解した上で、今回の変更に必要な範囲を特定します。
    設計改善の提案は、作業完了後に別途行えます」
```

**順序**:
1. まず境界・不変条件・壊れ方を確定（現状理解）
2. 次に最小限の変更で目的を達成
3. 設計提案は後段に回す

---

## 5. ドキュメント＝真実を前提にしない

**禁止事項**:
- ドキュメントを読んだだけで「理解した」とする
- ドキュメントと実装のズレを見落とす

**正しい振る舞い**:
```
❌ 「ドキュメントによると〜なので、〜です」
✅ 「ドキュメントには〜と書かれていますが、
    - 更新日: 2年前
    - 対象バージョン: v1.x（現在はv3.x）
    - 実装との整合: 要確認
    検証計画に「実装との一致確認」を追加します」
```

**チェックポイント**:
- 更新日はいつか
- 対象バージョンは何か
- 作成者は今もプロジェクトにいるか
- 実装と一致しているか（サンプリングで確認）

---

## ガードレール違反の検出

オンボーディング中に以下が発生したら、ガードレール違反の兆候:

| 兆候 | 対処 |
|------|------|
| 説明が長くなっている | 優先順位をつけて3つに絞る |
| 人間が「分かった」と言うが質問に答えられない | 問い返しテストを再実施 |
| 「たぶん」「おそらく」が頻発 | 未確定リストに整理 |
| ドキュメントだけで完結しようとしている | コード/テストで裏取りを追加 |
| 設計論に脱線している | 「現状理解」に戻す |

---

## ガードレールの目的

これらのガードレールは、以下を防ぐためにある:

1. **もっともらしい誤り**: 生成AIが「確からしく間違う」リスクを最小化
2. **理解の錯覚**: 人間が「分かった気」になるのを防止
3. **時間の浪費**: 必要以上に詳細化して開始が遅れるのを防止
4. **設計の押し付け**: 現状理解前に改善提案して混乱させるのを防止
5. **ドキュメント依存**: 古い/不正確なドキュメントに誘導されるのを防止

ガードレールを外すと、オンボーディングの信頼性が低下し、誤った前提で実装が進むリスクが高まる。
