# 作戦ブリーフ テンプレート

オンボーディング完了後に生成する1〜2画面の要約。作業中に参照し続ける。

---

## テンプレート

```markdown
# 作戦ブリーフ: [タスク名]

生成日時: YYYY-MM-DD HH:mm
オンボーディング所要時間: XX分

---

## 1. 目的

[1〜3文で記述]

### 成功条件
- [ ] 条件1（可能なら数値）
- [ ] 条件2
- [ ] 条件3

---

## 2. 境界マップ

```yaml
module: 対象モジュール名
responsibility: 責務の一言説明

in:
  - 入力1
out:
  - 出力1（副作用含む）
depends:
  - 依存1
owns:
  - 保証すること1

touch:      # 今回触る
  - 対象ファイル/関数
do_not_touch:  # 触らない
  - 対象ファイル/関数
```

---

## 3. 不変条件（壊してはいけないこと）

| # | 条件 | 根拠 | 破ったときの症状 |
|---|------|------|-----------------|
| 1 | [条件1] | [コード行/テスト名] | [症状] |
| 2 | [条件2] | [根拠] | [症状] |
| 3 | [条件3] | [根拠] | [症状] |

---

## 4. 壊れ方トップ3

### 起きやすい
- **パターン**: [説明]
- **検知**: [テスト名/ログキー/メトリクス]

### 致命的
- **パターン**: [説明]
- **検知**: [テスト名/ログキー/メトリクス]

### 気づきにくい
- **パターン**: [説明]
- **検知**: [テスト名/ログキー/メトリクス]

---

## 5. 着手前検証ToDo

| # | アクション | コマンド/手順 | 完了 |
|---|-----------|--------------|------|
| 1 | 既存テスト実行 | `npm test -- --grep "xxx"` | [ ] |
| 2 | 代表入力での動作確認 | [手順] | [ ] |
| 3 | ログ確認 | [ログキー] | [ ] |

### 反証条件
何が起きたらオンボーディングの仮説を捨てるか:
- [条件1: 例「テストが5件以上失敗」→「境界マップを再検討」]
- [条件2]

---

## 6. 未知リスト

| # | 項目 | 解消手段 | ステータス |
|---|------|---------|-----------|
| 1 | [まだ分かっていないこと] | [どうやって調べるか] | 未着手 |
| 2 | [項目] | [手段] | 未着手 |

---

## 根拠リンク

オンボーディングで参照した主要ソース:

| 種類 | パス/URL | 信頼度 | 備考 |
|------|---------|--------|------|
| コード | src/auth/login.ts | 高 | メインロジック |
| テスト | tests/auth.test.ts | 高 | 正常系カバー |
| ドキュメント | docs/auth.md | 中 | 2年前更新、要確認 |

---

## メモ

[オンボーディング中に出た重要なコメントや気づき]

```

---

## 品質チェックリスト

作戦ブリーフ生成後に確認:

- [ ] 1〜2画面に収まっているか（スクロールが必要なら削る）
- [ ] 各セクションに根拠リンクがあるか
- [ ] 未知リストが空でないか（ゼロは怪しい）
- [ ] 成功条件が判断可能か（主観語だけになっていないか）
- [ ] 不変条件が3つ以下か
- [ ] 壊れ方に検知手段があるか
- [ ] 検証ToDoが15〜30分で完了可能か

---

## アンチパターン

### ❌ 長すぎる
```
目的:
このタスクは、ユーザー認証システムにおいて、JWTトークンの
有効期限切れ時に適切なリフレッシュトークンを発行し、
セッションを継続させる機能を実装することを目的としています。
具体的には...（3段落続く）
```

### ✅ 簡潔
```
目的: JWTリフレッシュトークン機能の実装
成功条件: トークン期限切れ後も403なしでAPI継続利用可能
```

### ❌ 根拠なし
```
不変条件: セッションは常に有効であること
```

### ✅ 根拠あり
```
不変条件: アクティブセッションは最大1つ
根拠: src/auth/session.ts:142 の排他制御
症状: 複数ログインで片方がログアウトされる
```

---

## 使用方法

1. オンボーディング完了時にこのテンプレートを埋める
2. 人間に提示して確認を得る
3. 作業中は常にこのブリーフを参照する
4. 作業完了時に「成功条件」のチェックを確認
5. 未知リストが解消されたか確認
