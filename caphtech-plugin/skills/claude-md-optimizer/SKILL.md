---
name: claude-md-optimizer
description: |
  プロジェクトのすべてのCLAUDE.mdファイルをベストプラクティスに基づいて分析・適正化するスキル。
  命令数の肥大化、情報の配置ミス、書くべきでない内容の混入を検出し、具体的な改善を提案・適用する。
  使用タイミング:
  (1) 「CLAUDE.mdを適正化して」「CLAUDE.mdを最適化して」「CLAUDE.mdをレビューして」
  (2) 「CLAUDE.mdが長すぎる」「Claudeが指示を守らない」
  (3) プロジェクト設定の棚卸し・定期メンテナンス時
  (4) 新規プロジェクトのCLAUDE.mdテンプレート作成時
---

# CLAUDE.md Optimizer

プロジェクト内の全CLAUDE.mdを発見・分析し、ベストプラクティスに基づいて適正化する。

## ワークフロー

```
1. 発見 → 2. 分析 → 3. レポート → 4. 適正化（ユーザー確認後）
```

### Step 1: CLAUDE.mdの発見

プロジェクト内の全CLAUDE.mdファイルを収集する。

```bash
# 検索対象
find . -name "CLAUDE.md" -o -name "CLAUDE.local.md" | sort
```

併せて確認:
- `~/.claude/CLAUDE.md`（グローバル設定）
- `.claude/settings.json`（Hooks定義）
- `.claude/skills/`（Skills定義）
- `.claude/commands/`（カスタムコマンド）

### Step 2: 7観点からの分析

詳細な分析基準は [references/best-practices.md](references/best-practices.md) を参照。

各CLAUDE.mdに対して以下の観点で分析する:

| # | 観点 | 確認内容 |
|---|------|---------|
| 1 | 量の適正性 | 命令数が実質100-150件以下か |
| 2 | 内容の適正性 | コードから読み取れない＋毎セッション必要な情報のみか |
| 3 | NG内容の検出 | 書くべきでない内容が混入していないか |
| 4 | 情報配置の適正性 | CLAUDE.md / Skills / Hooks / commands の使い分けは正しいか |
| 5 | 階層の適正性 | グローバル / プロジェクト / サブディレクトリの使い分けは正しいか |
| 6 | 強調の適正性 | 重要ルールの強調手法は適切か |
| 7 | 構造の適正性 | 推奨テンプレートに沿っているか |

### Step 3: レポート出力

```markdown
## CLAUDE.md 適正化レポート

### 対象ファイル
- `./CLAUDE.md` (XX行, 推定命令数: NN件)
- `./src/feature/CLAUDE.md` (YY行, 推定命令数: MM件)

### サマリー
- 🔴 要対応: X件（命令数超過、NG内容混入）
- 🟡 推奨: Y件（配置変更、構造改善）
- 🟢 良好: Z件

### 検出された問題

#### 🔴 要対応

1. **[観点名] 問題タイトル**
   - 該当箇所: `ファイル:行`
   - 問題: 具体的な問題の説明
   - 改善案: 具体的な改善方法（移動先/削除/書き換え）

#### 🟡 推奨
...

### 推奨アクション（優先順）
1. [最優先] 〜を削除/移動
2. [推奨] 〜をSkillに分離
3. ...
```

### Step 4: 適正化の実行

ユーザー確認後、以下のアクションを実行する:

- **削除**: コードから読み取れる情報、冗長な記述を削除
- **移動**: 特定ドメイン知識→Skills、毎回実行処理→Hooks、ワークフロー→commands
- **書き換え**: 曖昧な記述の明確化、禁止事項への代替手段追加、構造の整理
- **強調調整**: 重要ルールにIMPORTANT:追加、冒頭・末尾への配置変更

IMPORTANT: 適正化は必ずユーザーに変更内容を提示し、確認を得てから実行する。

## 推定命令数の数え方

以下をそれぞれ1命令としてカウントする:
- 箇条書きの各項目
- テーブルの各行（ヘッダー除く）
- コードブロック内の各コマンド行
- 独立した文（段落内の各文）

セクション見出しや空行はカウントしない。バジェット: システムプロンプト約50件 + CLAUDE.md実質100-150件。

## テンプレート（新規作成時）

CLAUDE.mdが存在しないプロジェクトでは、以下のテンプレートを提案する:

```markdown
# [プロジェクト名]

## Overview
[サービスの目的を1-2文で]

## Tech Stack
- [フレームワーク/ライブラリ]
- [DB/インフラ]

## Commands
- dev:       [コマンド]
- test:      [コマンド]
- typecheck: [コマンド]
- build:     [コマンド]

## Code Style
- [言語・スタイル規約]
- [命名規則]

## Architecture
- [重要なディレクトリの役割]
- [設計上の重要な判断]

## Workflow
- [ブランチ戦略]
- [PR / マージ方針]

## Known Gotchas
- [プロジェクト固有の落とし穴と代替手段]
```
